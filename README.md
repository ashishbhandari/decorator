  
  
# Decorator
  
  
[![LICENSE][LICENSE-shield]][LICENSE]
[![Build status][travis-shield]][repo]
[![Code coverage][code-coverage-shield]][repo]
[![Pub version][pub-version-shield]][pub-link]
[![Commitizen friendly][commitizen-shield]][commitizen]
[![Commitizen style][commitizen-style-shield]][cz-emoji]
[![Maintained][maintenance-shield]][repo]
  
## :rocket: About
  
  
Python's decorators in dart :fireworks:
  
**Note**: This is a work-in-progress
  
## :page_facing_up: TOC
  
  
  
  
  
  
1. [:rocket: About](#rocket-about )
2. [:page_facing_up: TOC](#page_facing_up-toc )
3. [:book: Usage](#book-usage )
    1. [1. Decorator annotation](#1-decorator-annotation )
    2. [2. Decorator generator](#2-decorator-generator )
4. [:traffic_light: Versioning](#traffic_light-versioning )
5. [:memo: Milestones](#memo-milestones )
6. [:medal_sports: Principle](#medal_sports-principle )
7. [:busts_in_silhouette: Contributing](#busts_in_silhouette-contributing )
8. [:octocat: Git](#octocat-git )
9. [:lipstick: Code style](#lipstick-code-style )
10. [:white_check_mark: Testing](#white_check_mark-testing )
11. [:sparkles: Features and :bug:bugs](#sparkles-features-and-bugbugs )
12. [:newspaper: Changelog](#newspaper-changelog )
    1. [1. Decorator annotation](#1-decorator-annotation-1 )
        1. [0.0.1](#001 )
    2. [2. Decorator generator](#2-decorator-generator-1 )
        1. [0.0.1](#001-1 )
13. [:scroll: License](#scroll-license )
  
  
  
  
## :book: Usage
  
  
### 1. Decorator annotation
  
  
  
  
  
```dart
import 'package:decorator/decorator.dart';
  
/// There are 2 ways for creating custom decorators
  
/// 1. Either use the provided [DecorateWith] decorator to create wrapper
/// functions and use [DecorateWith] as a proxy decorator
  
/// Greets the host
HostElement<R> greet<R>(HostElement<R> host) {
  print('Hello $host');
  
  return host;
}
  
/// 2. Or implement the [Wrapper] and [FunctionDecorator] interfaces, and create
/// the decorator yourself
  
/// Decorater that null checks all args
class ArgumentsNotNull implements Wrapper, FunctionDecorator {
  const ArgumentsNotNull();
  @override
  bool get runInRelease => true;
  
  @override
  HostElement<R> wraps<R>(HostElement<R> host) {
    if (host.args?.isNotEmpty ?? false) {
      for (var arg in host.args.keys) {
        if (host.args[arg] == null) {
          throw ArgumentError.notNull(arg);
        }
      }
    }
  
    if (host.kwargs?.keys?.isNotEmpty ?? false) {
      for (var kwarg in host.kwargs.keys) {
        if (host.kwargs[kwarg] == null) {
          throw ArgumentError.notNull(kwarg);
        }
      }
    }
  
    return host;
  }
}
  
```  
  
  
### 2. Decorator generator
  
  
  
  
  
```dart
/// Creating a library is required for part generation to work
library decorator_generator.example;
  
/// Import the decorator package
import 'package:decorator/decorator.dart';
import 'package:logging/logging.dart';
  
/// Import the generated part
/// this is generated by running `pub run build_runner build`
part 'example.d.dart';
  
Future<void> main() async {
  print(joinArgs(['First'], arg2: ['Second']));
  print(joinArgs3(['First'], arg2: ['Second']));
  print(await joinArgs4(['First'], arg2: ['Second']));
  
  /// This will throw automatically before [_joinArgs2]
  /// gets executed
  // print(joinArgs2(['First'], null));
}
  
const Level myLevel = Level('mylevel', 555);
  
/// Logger for `decorator_generator.example`
final Logger logger = Logger('decorator_generator.example');
  
HostElement<R> greet<R>(HostElement<R> host) {
  print('Hello $host');
  
  return host;
}
  
/// This function joins its args
@MyLogger('_joinArgs', myLevel)
String _joinArgs(List<String> arg1, {List<String> arg2}) {
  print('_joingArgs executed');
  
  return ((arg1 ?? [])..addAll(arg2 ?? [])).join();
}
  
/// This function also joins its args but doesnt check them against being null
@ArgumentsNotNull()
String _joinArgs2(List<String> arg1, [List<String> arg2]) {
  print('_joinArgs2 executed');
  
  /// Here arguments are not being null checked
  /// but the [ArgumentsNotNull] decorator will throw even before this code gets
  /// executed
  return (arg1..addAll(arg2)).join();
}
  
/// This one also joins its args but it is decorated with a [HostWrapper], this
/// is useful when the decorater doesn't require any additional args.
@DecorateWith(greet)
String _joinArgs3(List<String> arg1, {List<String> arg2}) {
  print('_joingArgs3 executed');
  
  return ((arg1 ?? [])..addAll(arg2 ?? [])).join();
}
  
/// Another one just for fun
@MyLogger.detached('loggerName')
Future<String> _joinArgs4(List<String> arg1, {List<String> arg2}) async {
  print('_joingArgs4 executed');
  
  return ((arg1 ?? [])..addAll(arg2 ?? [])).join();
}
  
/// Decorater that null checks all args
class ArgumentsNotNull implements Wrapper, FunctionDecorator {
  const ArgumentsNotNull();
  @override
  bool get runInRelease => true;
  
  @override
  HostElement<R> wraps<R>(HostElement<R> host) {
    if (host.args?.isNotEmpty ?? false) {
      for (var arg in host.args.keys) {
        if (host.args[arg] == null) {
          throw ArgumentError.notNull(arg);
        }
      }
    }
  
    if (host.kwargs?.keys?.isNotEmpty ?? false) {
      for (var kwarg in host.kwargs.keys) {
        if (host.kwargs[kwarg] == null) {
          throw ArgumentError.notNull(kwarg);
        }
      }
    }
  
    return host;
  }
}
  
/// Decorater that logs the given host with any args
class MyLogger implements Wrapper, FunctionDecorator {
  /// Name of the logger to use
  final String loggerName;
  final Level logLevel;
  
  /// Wether this is a detached logger
  final bool isDetached;
  
  /// Uses the given logger [loggerName] for logging at [logLevel]
  const MyLogger(this.loggerName, [this.logLevel = Level.FINEST])
      : isDetached = false;
  
  /// Uses a detached logger for logging
  const MyLogger.detached(this.loggerName, [this.logLevel = Level.FINEST])
      : isDetached = true;
  
  @override
  bool get runInRelease => false;
  
  @override
  HostElement<R> wraps<R>(HostElement<R> host) {
    final message = '$host was called with '
        '\nargs:${host.args} and \nkwargs:${host.kwargs}';
  
    if (isDetached) {
      Logger.detached(loggerName).log(logLevel, message);
    } else {
      Logger(loggerName).log(logLevel, message);
    }
  
    return host;
  }
}
  
```  
  
  
## :traffic_light: Versioning
  
  
This project follows [Semantic Versioning 2.0.0][semver]
  
## :memo: Milestones
  
  
- [ ] Prepare v1.0.0
  - [ ] allow decorating class methods
  - [ ] allow decorating class fields
  - [x] allow decorating top-level methods
  - [ ] allow decorating top-level fields
  - [ ] allow decorating classes
  - [ ] allow decorating libraries
  
## :medal_sports: Principle
  
  
This project follows [The Twelve-Factor App](https://12factor.net/ ) principle
  
## :busts_in_silhouette: Contributing
  
  
- :fork_and_knife: Fork this repo
  
- :arrow_down: Clone your forked version  
  `git clone https://github.com/<you>/decorator.git`
  
- :heavy_plus_sign: Add this repo as a remote  
  `git remote add upstream https://github.com/devkabiir/decorator.git`
  
- :arrow_double_down: Make sure you have recent changes  
  `git fetch upstream`
  
- :sparkles: Make a new branch with your proposed changes/fixes/additions  
  `git checkout upstream/master -b name_of_your_branch`
  
- :bookmark_tabs: Make sure you follow guidelines for [Git](#git )
  
- :arrow_double_up: Push your changes  
  `git push origin name_of_your_branch`
  
- :arrows_clockwise: Make a pull request
  
## :octocat: Git
  
  
- :heavy_check_mark: Sign all commits. Learn about [signing-commits]
- Use [commitizen] with [cz-emoji] adapter
- Check existing commits to get an idea
- Run the pre_commit script from project root `pub run pre_commit`
- If you're adding an `and` in your commit message, it should probably be separate commits
- Link relevant issues/commits with a `#` sign in the commit message
- Limit message length per line to 72 characters (excluding space required for linking issues/commits)
- Add commit description if message isn't enough for explaining changes
  
## :lipstick: Code style
  
  
- Maintain consistencies using included `.editorconfig`
- Everything else as per standard dart [guidelines]
  
## :white_check_mark: Testing
  
  
- Add tests for each new addition/feature
- Do not remove/change tests when refactoring
  - unless fixing already broken test.
  
## :sparkles: Features and :bug:bugs
  
  
Please file feature requests and bugs at the [issue-tracker].
  
## :newspaper: Changelog
  
  
Changes for latest release at [github-releases]
  
  
### 1. Decorator annotation
  
  
  
#### 0.0.1
  
  
- Initial version
  
  
### 2. Decorator generator
  
  
  
#### 0.0.1
  
  
- Initial version
  
  
  
## :scroll: License
  
  
```   
MIT License
  
Copyright (c) 2019-Present Dinesh Ahuja <dev@kabiir.me>
  
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
  
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
  
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
  
```  
  
  
  
[LICENSE-shield]: https://img.shields.io/github/license/devkabiir/decorator.svg
[travis-shield]: https://img.shields.io/travis/com/devkabiir/decorator/master.svg
[code-coverage-shield]: https://img.shields.io/codecov/c/github/devkabiir/decorator/master.svg
[pub-version-shield]: https://img.shields.io/pub/v/decorator.svg
[commitizen-shield]: https://img.shields.io/badge/commitizen-friendly-brightgreen.svg
[commitizen-style-shield]: https://img.shields.io/badge/commitizen--style-emoji-brightgreen.svg
[maintenance-shield]: https://img.shields.io/maintenance/yes/2019.svg
  
  
  
[cz-emoji]: https://github.com/ngryman/cz-emoji
[commitizen]: http://commitizen.github.io/cz-cli/
[pub-link]: https://pub.dartlang.org/packages/decorator
[repo]: https://github.com/devkabiir/decorator
[guidelines]: https://www.dartlang.org/guides/language/effective-dart/style
[signing-commits]: https://help.github.com/articles/signing-commits/
[issue-tracker]: https://github.com/devkabiir/decorator/issues
[LICENSE]: https://github.com/devkabiir/decorator/blob/master/LICENSE
[semver]: https://semver.org/
[github-releases]: https://github.com/devkabiir/decorator/releases
  